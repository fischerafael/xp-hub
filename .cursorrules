# Cursor Rules

## Estrutura de Arquivos

- As rotas do Next.js devem estar desacopladas do código do app
- Na pasta `app/`, os arquivos de rota (`page.tsx`, `layout.tsx`, etc.) devem apenas importar e renderizar componentes de rotas
- Os componentes de rotas (com toda a lógica e estrutura) devem ficar em `src/routes/nome_da_rota.tsx`
- Exemplo:
  - Rota: `app/app/page.tsx` → apenas importa e renderiza `AppPage` de `src/routes/app.tsx`
  - Componente da rota: `src/routes/app.tsx` → contém toda a lógica e estrutura da página

## Regras

1. **Rotas (`app/**/page.tsx`)**: Devem ser arquivos simples que apenas importam e exportam o componente da rota correspondente de `src/routes/`
2. **Rotas (`src/routes/*.tsx`)**: Contêm toda a lógica, estado, e estrutura da página
3. **Componentes reutilizáveis**: Ficam em `components/`
4. **Utilitários**: Ficam em `lib/`
5. **Frontend nunca deve chamar services diretamente**: Todo acesso a services, repositories ou código protegido do servidor deve ser feito via API routes (`/api/**`). Use funções helper em `lib/` que fazem fetch para as rotas de API. Use TanStack Query (useQuery/useMutation) para gerenciar chamadas à API.

## API Routes (`app/api/**/route.ts`)

- API routes devem ser simples e diretas, apenas extraindo parâmetros e chamando services
- **Nunca** incluir lógica de negócio nas rotas - toda lógica deve estar nos services
- **Nunca** fazer validações de negócio nas rotas (validações de owner, campos obrigatórios, etc.)
- **Nunca** usar try/catch desnecessários - deixar erros propagarem naturalmente
- Extrair parâmetros de forma simples:
  - Headers: `request.headers.get("header-name") || ""`
  - SearchParams: `new URL(request.url).searchParams.get("param")`
  - Body: `await request.json()`
- Retornar diretamente: `return NextResponse.json(await serviceFunction(...))`
- Usar searchParams para todos os parâmetros (nunca route params)
- Status codes apenas quando necessário (ex: 201 para POST)
- **Todos os métodos HTTP** (GET, POST, PUT, DELETE) devem estar em uma única rota `route.ts`
- **ownerId sempre nos headers** (nunca query params ou body) - usar header `owner-id`
- **GET sempre com filtros via searchParams** (nunca body) - extrair `startDate`, `endDate`, `categoryIds` dos searchParams
- Para arrays em searchParams: usar formato `?categoryIds=id1,id2` e fazer split por vírgula

## Exemplo de Estrutura

```
app/
  app/
    page.tsx          # Apenas: import { AppPage } from "@/src/routes/app"; export default function Page() { return <AppPage />; }
  api/
    xp/
      route.ts        # API route simples que apenas chama xp-service
src/
  routes/
    app.tsx           # Toda a lógica e estrutura da página /app
  services/
    xp-service.ts     # Toda a lógica de negócio do XP
components/
  header.tsx
  footer.tsx
  ...
```
